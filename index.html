<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Venezuela Bistro - Ventas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .safe-area-pb { padding-bottom: env(safe-area-inset-bottom); }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        const MENU_PRODUCTS = [
            { id: 'ap_pabellon', name: 'Arepa de Pabell칩n', price: 40, category: 'Arepas' },
            { id: 'ap_pelua', name: 'Arepa Pel칰a', price: 40, category: 'Arepas' },
            { id: 'ap_camaron', name: 'Arepa de Camar칩n', price: 40, category: 'Arepas' },
            { id: 'ap_reina', name: 'Arepa Reina Pepeada', price: 35, category: 'Arepas' },
            { id: 'ap_catira', name: 'Arepa Catira', price: 35, category: 'Arepas' },
            { id: 'ap_pernil', name: 'Arepa de Pernil', price: 35, category: 'Arepas' },
            { id: 'ap_vegetariana', name: 'Arepa Vegetariana', price: 35, category: 'Arepas' },
            { id: 'em_queso', name: 'Empanada de Queso', price: 20, category: 'Empanadas' },
            { id: 'em_carne', name: 'Empanada de Carne Molida', price: 20, category: 'Empanadas' },
            { id: 'ca_queso', name: 'Cachapa de Queso', price: 35, category: 'Cachapas' },
            { id: 'ca_carne', name: 'Cachapa de Carne', price: 40, category: 'Cachapas' },
            { id: 'ca_pernil', name: 'Cachapa con Pernil', price: 35, category: 'Cachapas' },
            { id: 'ca_vegetales', name: 'Cachapa con Vegetales', price: 35, category: 'Cachapas' },
            { id: 'pa_carne', name: 'Pastelitos de Carne', price: 18, category: 'Pastelitos' },
            { id: 'pa_queso', name: 'Pastelitos de Queso', price: 18, category: 'Pastelitos' },
            { id: 'be_papelon', name: 'Jugo de Papel칩n', price: 15, category: 'Bebidas' },
            { id: 'be_agua', name: 'Agua Mineral', price: 5, category: 'Bebidas' },
            { id: 'be_guarana', name: 'Guaran치 Zero', price: 7, category: 'Bebidas' },
            { id: 'be_brahma', name: 'Cerveza Brahma', price: 7, category: 'Bebidas' },
        ];

        function App() {
            // Cargar datos guardados al iniciar
            const [sales, setSales] = useState(() => {
                const saved = localStorage.getItem('bistro_sales');
                return saved ? JSON.parse(saved) : {};
            });
            
            const [activeTab, setActiveTab] = useState('ventas');
            const [showConfirmReset, setShowConfirmReset] = useState(false);

            // Guardar datos autom치ticamente cada vez que cambien las ventas
            useEffect(() => {
                localStorage.setItem('bistro_sales', JSON.stringify(sales));
            }, [sales]);

            const addSale = (id) => {
                setSales(prev => ({ ...prev, [id]: (prev[id] || 0) + 1 }));
            };

            const removeSale = (id) => {
                setSales(prev => {
                    if (!prev[id]) return prev;
                    const newCount = prev[id] - 1;
                    if (newCount <= 0) {
                        const newState = { ...prev };
                        delete newState[id];
                        return newState;
                    }
                    return { ...prev, [id]: newCount };
                });
            };

            const stats = useMemo(() => {
                let totalItems = 0, totalValue = 0, mostSold = { name: 'N/A', count: 0 };
                Object.entries(sales).forEach(([id, count]) => {
                    const product = MENU_PRODUCTS.find(p => p.id === id);
                    if (product) {
                        totalItems += count;
                        totalValue += (product.price * count);
                        if (count > mostSold.count) mostSold = { name: product.name, count };
                    }
                });
                return { totalItems, totalValue, mostSold };
            }, [sales]);

            const exportToCSV = () => {
                const headers = "Producto,Cantidad,Precio Unitario (R$),Subtotal (R$)\n";
                const rows = MENU_PRODUCTS.filter(p => sales[p.id]).map(p => `${p.name},${sales[p.id]},${p.price},${p.price * sales[p.id]}`).join("\n");
                const footer = `\nTOTAL,${stats.totalItems},,${stats.totalValue}`;
                const csvContent = "data:text/csv;charset=utf-8," + encodeURIComponent(headers + rows + footer);
                const link = document.createElement("a");
                link.setAttribute("href", csvContent);
                link.setAttribute("download", `Ventas_Bistro_${new Date().toLocaleDateString()}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const resetAll = () => {
                setSales({});
                localStorage.removeItem('bistro_sales');
                setShowConfirmReset(false);
            };

            return (
                <div className="min-h-screen flex flex-col">
                    <header className="bg-yellow-400 p-5 shadow-lg rounded-b-[2.5rem] sticky top-0 z-20">
                        <div className="max-w-md mx-auto flex justify-between items-center">
                            <div>
                                <h1 className="text-xl font-black text-blue-800 leading-none">VENEZUELA BISTRO</h1>
                                <span className="text-[10px] font-bold text-red-600 tracking-tighter">CONTROLE DE VENDAS</span>
                            </div>
                            <div className="bg-white/90 px-4 py-1.5 rounded-2xl shadow-inner text-right">
                                <p className="text-[10px] font-bold text-slate-400 leading-none">TOTAL</p>
                                <p className="text-lg font-black text-slate-800 leading-none">R$ {stats.totalValue}</p>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-md mx-auto w-full p-4 pb-24 flex-grow">
                        {activeTab === 'ventas' ? (
                            <div className="space-y-6 animate-slide-up">
                                {['Arepas', 'Empanadas', 'Cachapas', 'Pastelitos', 'Bebidas'].map(cat => (
                                    <div key={cat}>
                                        <h2 className="text-xs font-black text-slate-400 uppercase ml-2 mb-2 tracking-widest">{cat}</h2>
                                        <div className="space-y-2">
                                            {MENU_PRODUCTS.filter(p => p.category === cat).map(product => (
                                                <div key={product.id} className="bg-white p-4 rounded-2xl shadow-sm flex items-center justify-between border border-slate-100">
                                                    <div className="flex-1" onClick={() => addSale(product.id)}>
                                                        <p className="font-bold text-slate-800 text-sm">{product.name}</p>
                                                        <p className="text-xs font-bold text-blue-600">R$ {product.price}</p>
                                                    </div>
                                                    <div className="flex items-center gap-3">
                                                        {sales[product.id] > 0 && (
                                                            <button onClick={(e) => { e.stopPropagation(); removeSale(product.id); }} className="w-8 h-8 rounded-full bg-slate-100 flex items-center justify-center text-slate-500">-</button>
                                                        )}
                                                        <span className={`w-6 text-center font-black ${sales[product.id] ? 'text-blue-600' : 'text-slate-200'}`}>
                                                            {sales[product.id] || 0}
                                                        </span>
                                                        <button onClick={(e) => { e.stopPropagation(); addSale(product.id); }} className="w-8 h-8 rounded-full bg-yellow-400 flex items-center justify-center text-blue-800 font-bold shadow-sm">+</button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="space-y-4 animate-slide-up">
                                <div className="grid grid-cols-2 gap-3">
                                    <div className="bg-white p-4 rounded-3xl shadow-sm border border-slate-100 text-center">
                                        <p className="text-[10px] font-bold text-slate-400 uppercase">Vendidos</p>
                                        <p className="text-2xl font-black">{stats.totalItems}</p>
                                    </div>
                                    <div className="bg-white p-4 rounded-3xl shadow-sm border border-slate-100 text-center">
                                        <p className="text-[10px] font-bold text-slate-400 uppercase">Ingresos</p>
                                        <p className="text-2xl font-black text-green-600">R${stats.totalValue}</p>
                                    </div>
                                </div>
                                <div className="bg-blue-700 p-5 rounded-3xl text-white shadow-lg">
                                    <p className="text-[10px] font-bold uppercase opacity-70">Top de Hoy</p>
                                    <p className="text-xl font-black">{stats.mostSold.name}</p>
                                    <p className="text-sm opacity-90">{stats.mostSold.count} unidades</p>
                                </div>
                                <button onClick={exportToCSV} className="w-full bg-slate-800 text-white p-4 rounded-2xl font-black text-sm shadow-md flex items-center justify-center gap-2">
                                    <span>游닌</span> DESCARGAR EXCEL (.CSV)
                                </button>
                                <button onClick={() => setShowConfirmReset(true)} className="w-full text-red-500 p-4 font-bold text-sm flex items-center justify-center gap-2">
                                    <span>游댃</span> REINICIAR CONTADOR
                                </button>
                                <p className="text-[10px] text-center text-slate-400 italic font-medium px-4">
                                    * Los datos se guardan autom치ticamente en este tel칠fono. No se pierden al cerrar la app.
                                </p>
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-sm border-t border-slate-100 p-3 safe-area-pb">
                        <div className="max-w-md mx-auto grid grid-cols-2 gap-4">
                            <button onClick={() => setActiveTab('ventas')} className={`p-3 rounded-2xl flex flex-col items-center transition-all ${activeTab === 'ventas' ? 'bg-yellow-400 text-blue-900 shadow-md' : 'text-slate-400'}`}>
                                <span className="text-[10px] font-black uppercase">游 Ventas</span>
                            </button>
                            <button onClick={() => setActiveTab('resumen')} className={`p-3 rounded-2xl flex flex-col items-center transition-all ${activeTab === 'resumen' ? 'bg-yellow-400 text-blue-900 shadow-md' : 'text-slate-400'}`}>
                                <span className="text-[10px] font-black uppercase">游늵 Reporte</span>
                            </button>
                        </div>
                    </nav>

                    {showConfirmReset && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-6 z-50">
                            <div className="bg-white rounded-[2rem] p-6 w-full max-w-xs text-center shadow-2xl animate-slide-up">
                                <h3 className="font-black text-slate-800 text-lg mb-2">쯃impiar todo?</h3>
                                <p className="text-slate-500 text-xs mb-6">Se borrar치n las ventas guardadas. Aseg칰rate de haber bajado el Excel si quieres guardar los datos de hoy.</p>
                                <div className="flex gap-2">
                                    <button onClick={() => setShowConfirmReset(false)} className="flex-1 p-3 rounded-xl bg-slate-100 font-bold text-slate-400">No, cancelar</button>
                                    <button onClick={resetAll} className="flex-1 p-3 rounded-xl bg-red-500 text-white font-bold">S칤, borrar</button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>